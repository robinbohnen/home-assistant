airco_livingroom_package:
  automation:
    - id: ac_livingroom_on
      alias: Livingroom - AC Automatically on
      description: Turn on AC when hot inside
      mode: single
      triggers:
        - trigger: numeric_state
          entity_id:
            - sensor.woonkamer_temperatuur
          above: 22.5
        - trigger: state
          entity_id:
            - binary_sensor.woonkamer_openslaande_deuren_contact
          to: "off"
      conditions:
        - condition: state
          entity_id: climate.woonkamer
          state: "off"
      actions:
        - variables:
            action_ac_living_on: "{{ 'OPEN_' ~ context.id }}"
        - if:
            - condition: state
              entity_id: binary_sensor.woonkamer_openslaande_deuren_contact
              state: "off"
          then:
            - action: notify.mobile_devices_adults
              metadata: {}
              data:
                message: Het is warm binnen in de woonkamer, wil je de airco aanzetten?
                title: Warm in Woonkamer
                data:
                  actions:
                    - action: "{{ action_ac_living_on }}"
                      title: Ja
            - wait_for_trigger:
                - event_type: mobile_app_notification_action
                  event_data:
                    action: "{{ action_ac_living_on }}"
                  trigger: event
              timeout:
                hours: 0
                minutes: 15
                seconds: 0
                milliseconds: 0
            - choose:
                - conditions:
                    - condition: template
                      value_template: "{{ wait.trigger.event.data.action == action_ac_living_on }}"
                  sequence:
                    - action: climate.turn_on
                      metadata: {}
                      data: {}
                      target:
                        entity_id: climate.woonkamer
                    - action: climate.set_hvac_mode
                      metadata: {}
                      data:
                        hvac_mode: cool
                      target:
                        entity_id: climate.woonkamer
                    - action: climate.set_temperature
                      metadata: {}
                      data:
                        temperature: 18
                      target:
                        entity_id: climate.woonkamer
                    - action: climate.set_fan_mode
                      metadata: {}
                      data:
                        fan_mode: auto
                      target:
                        entity_id: climate.woonkamer
                    - action: climate.set_swing_mode
                      metadata: {}
                      data:
                        swing_mode: auto
                      target:
                        entity_id: climate.woonkamer
                    - action: climate.set_swing_horizontal_mode
                      metadata: {}
                      data:
                        swing_horizontal_mode: auto
                      target:
                        entity_id: climate.woonkamer
          else:
            - if:
                - condition: numeric_state
                  entity_id: sensor.woonkamer_temperatuur
                  above: 22.5
              then:
                - action: notify.mobile_devices_adults
                  metadata: {}
                  data:
                    message: >-
                      Het is warm binnen in de woonkamer, doe de deuren dicht om de
                      airco aan te zetten.
                    title: Warm in Woonkamer, deuren open
                    data: {}

    - id: ac_off_evening
      alias: Livingroom - AC Automatically off
      description: "Turn off AC when is on for more than 2 hours and almost time to go to bed"
      mode: single
      triggers:
        - trigger: time
          at: "21:00:00"
        - trigger: time
          at: "22:00:00"
        - trigger: time
          at: "23:00:00"
      conditions:
        - condition: state
          entity_id: climate.airco_woonkamer
          state:
            - heat
          for:
            hours: 2
            minutes: 0
            seconds: 0
        - condition: numeric_state
          entity_id: climate.airco_woonkamer
          attribute: current_temperature
          above: 20
      actions:
        - action: climate.turn_off
          metadata: {}
          target:
            entity_id: climate.airco_woonkamer
          data: {}
